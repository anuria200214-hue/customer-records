<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Management | Enterprise Terminal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --sidebar-bg: #1d2327; --app-bg: #f0f0f1; --accent-blue: #2271b1; }
        body { background-color: var(--app-bg); font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; display: flex; margin: 0; min-height: 100vh; }
        #sidebar { width: 220px; background: var(--sidebar-bg); min-height: 100vh; color: #c3c4c7; display: flex; flex-direction: column; position: sticky; top: 0; }
        .side-item { padding: 12px 20px; cursor: pointer; font-size: 14px; color: #c3c4c7; display: flex; align-items: center; border-left: 4px solid transparent; }
        .side-item:hover, .side-item.active { background: #2c3338; color: white; border-left-color: var(--accent-blue); }
        #main-content { flex-grow: 1; padding: 25px; min-width: 0; }
        .wp-card { background: white; border: 1px solid #c3c4c7; padding: 20px; border-radius: 4px; margin-bottom: 20px; }
        .stat-value { font-size: 26px; font-weight: bold; color: #1d2327; }
        .hidden { display: none !important; }
        
        /* Badges & Highlights */
        .follow-up-due { border-left: 5px solid #ffb900 !important; background-color: #fffdfa !important; }
        .insurance-due { border-left: 5px solid #d63638 !important; background-color: #fffafa !important; }
        .badge-reminder {
            display: inline-flex; align-items: center; font-size: 9px; padding: 2px 6px;
            border-radius: 4px; text-transform: uppercase; font-weight: 800; margin-left: 10px;
            line-height: 1; vertical-align: middle;
        }
        .bg-followup { background-color: #fff8e1; color: #8a6d3b; border: 1px solid #ffb900; }
        .bg-insurance { background-color: #fbe9e7; color: #c62828; border: 1px solid #d63638; }

        #login-overlay { z-index: 10000; background: rgba(30,30,30,0.96); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        #denied-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: red; text-align: center; }
    </style>
</head>
<body>

<nav id="sidebar">
    <div class="p-3 fw-bold border-bottom border-secondary mb-2" style="font-size: 11px; color: #72777c; letter-spacing: 1px;">TERMINAL</div>
    <div class="px-3 py-2 mb-2"><span class="badge bg-primary w-100 py-2" id="sidebar-shop-label">SYSTEM</span></div>
    <div class="side-item admin-only hidden" id="nav-dash" onclick="navigateTo('dashboard')"><i class="bi bi-speedometer2 me-2"></i> Dashboard</div>
    <div class="side-item active" id="nav-form" onclick="navigateTo('form')"><i class="bi bi-plus-circle me-2"></i> New Entry</div>
    <div class="side-item admin-only hidden" id="nav-settings" onclick="navigateTo('settings')"><i class="bi bi-gear me-2"></i> Settings</div>
    <div class="mt-auto p-3 admin-only hidden"><button class="btn btn-sm btn-outline-danger w-100" onclick="terminateSession()">LOGOUT</button></div>
</nav>

<main id="main-content">
    <div id="login-overlay" class="hidden">
        <div class="wp-card shadow-lg" style="width: 340px;">
            <h5 class="text-center mb-4">Master Admin Access</h5>
            <input type="password" id="admin-pass-input" class="form-control mb-3" placeholder="Access Token">
            <button class="btn btn-primary w-100" onclick="handleLogin()">Authorize</button>
            <p id="login-error" class="text-danger small mt-2 text-center hidden">Access Denied</p>
        </div>
    </div>

    <section id="view-dashboard" class="hidden">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="m-0">Customer Records</h4>
            <select id="masterShopDropdown" class="form-select form-select-sm" style="width: 220px;" onchange="filterBy(this.value)">
                <option value="all">All Shop Records</option>
            </select>
        </div>
        
        <div class="row g-3 mb-4 text-center">
            <div class="col-md-4"><div class="wp-card small text-muted">TOTAL RECORDS<div class="stat-value" id="stat-count">0</div></div></div>
            <div class="col-md-4"><div class="wp-card small text-muted">NET REVENUE<div class="stat-value" id="stat-revenue">₹0.00</div></div></div>
            <div class="col-md-4"><div class="wp-card small text-muted">ACTIVE CATEGORIES<div class="stat-value" id="stat-services">0</div></div></div>
        </div>

        <div class="row mb-4">
            <div class="col-md-7"><div class="wp-card"><h6>Volume Trends (Active Only)</h6><div style="height: 250px;"><canvas id="barChart"></canvas></div></div></div>
            <div class="col-md-5"><div class="wp-card"><h6>Category Mix</h6><div style="height: 250px;"><canvas id="pieChart"></canvas></div></div></div>
        </div>

        <div class="wp-card mb-3 p-2"><input type="text" id="tableSearch" class="form-control border-0 shadow-none" placeholder="Search..." onkeyup="filterTableData()"></div>
        <div class="wp-card">
            <div class="table-responsive">
                <table class="table table-sm table-hover align-middle" style="font-size: 13px;">
                    <thead class="table-light">
                        <tr><th>Unit</th><th>Customer</th><th>Contact</th><th>Service Type</th><th>Amount</th><th>Date</th><th>Time</th><th class="text-end">Actions</th></tr>
                    </thead>
                    <tbody id="recordTableBody"></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="view-form">
        <div class="row justify-content-center pt-5">
            <div class="col-md-5">
                <div class="wp-card shadow-sm border-top border-primary border-4">
                    <h5 class="mb-4 fw-bold">New Service Entry</h5>
                    <form id="entryForm">
                        <div class="mb-3"><label class="small fw-bold">Active Branch</label><input type="text" id="displayShopId" class="form-control bg-light border-0" readonly></div>
                        <div class="row">
                            <div class="col-6 mb-3"><label class="small fw-bold">Date</label><input type="text" id="custDate" class="form-control bg-light border-0" readonly></div>
                            <div class="col-6 mb-3"><label class="small fw-bold">Time</label><input type="text" id="custTime" class="form-control bg-light border-0" readonly></div>
                        </div>
                        <div class="mb-3"><label class="small fw-bold">Customer Name</label><input type="text" id="custName" class="form-control" required></div>
                        <div class="mb-3"><label class="small fw-bold">Phone</label><input type="tel" id="custPhone" class="form-control" pattern="[0-9]{10}"></div>
                        <div class="mb-3"><label class="small fw-bold">Service</label><select id="custService" class="form-select"></select></div>
                        <div class="mb-4"><label class="small fw-bold">Amount (₹)</label><input type="number" id="custAmount" class="form-control" required></div>
                        <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">SAVE RECORD</button>
                        <div id="success-alert" class="alert alert-success d-none mt-3 py-2 text-center">Record Saved!</div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <section id="view-settings" class="hidden">
        <div class="wp-card">
            <h6 class="fw-bold mb-3">Service Registry</h6>
            <div class="d-flex gap-2 mb-3">
                <input type="text" id="serviceInput" class="form-control form-control-sm" placeholder="New Category">
                <button class="btn btn-sm btn-primary px-4" onclick="registerService()">Add</button>
            </div>
            <div id="serviceRegistry" class="d-flex flex-wrap gap-2"></div>
        </div>
    </section>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="script.js"></script>
</body>
</html>